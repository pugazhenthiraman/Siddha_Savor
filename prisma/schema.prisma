generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "windows", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  password   String
  smtpConfig Json?
  createdAt  DateTime @default(now())
}

model Doctor {
  id          Int             @id @default(autoincrement())
  doctorUID   String?         @unique @db.VarChar(8)
  email       String          @unique
  password    String?
  status      DoctorStatus    @default(PENDING)
  formData    Json
  inviteToken String?         @unique
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  patients    Patient[]
  vitals      PatientVitals[]
}

model Patient {
  id          Int             @id @default(autoincrement())
  patientUID  String?         @unique @db.VarChar(8)
  email       String
  password    String?
  formData    Json
  inviteToken String?         @unique
  doctorUID   String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  status      DoctorStatus    @default(PENDING)
  mealStatus  MealStatus[]
  customDietPlan CustomDietPlan?
  doctor      Doctor?         @relation(fields: [doctorUID], references: [doctorUID])
  vitals      PatientVitals[]
}

model PatientVitals {
  id                     Int      @id @default(autoincrement())
  patientId              Int
  doctorUID              String
  pulseRate              Int?
  heartRate              Int?
  temperature            Float?
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  respiratoryRate        Int?
  oxygenSaturation       Float?
  weight                 Float?
  bmr                    Float?
  tdee                   Float?
  assessmentType         String?
  medicines              Json?
  notes                  String?
  recordedAt             DateTime @default(now())
  recordedBy             String
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  naadi                  String?
  randomBloodSugar       Int?
  thegi                  String?
  diagnosis              String?
  doctor                 Doctor   @relation(fields: [doctorUID], references: [doctorUID])
  patient                Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@index([doctorUID])
}

model MealStatus {
  id        Int      @id @default(autoincrement())
  patientId Int
  date      DateTime
  mealType  String
  status    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@unique([patientId, date, mealType], name: "patientId_date_mealType")
  @@index([patientId])
}

model CustomDietPlan {
  id        Int      @id @default(autoincrement())
  patientId Int      @unique
  planData  Json
  startDate DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model InviteLink {
  id             Int        @id @default(autoincrement())
  token          String     @unique
  role           InviteRole
  doctorUID      String?
  createdBy      String     @default("ADMIN")
  recipientEmail String?
  recipientName  String?
  isUsed         Boolean    @default(false)
  usedAt         DateTime?
  expiresAt      DateTime
  createdAt      DateTime   @default(now())
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  email     String
  token     String   @unique
  code      String
  userRole  String
  data      Json
  isUsed    Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum DoctorStatus {
  PENDING
  APPROVED
  REJECTED
}

enum InviteRole {
  DOCTOR
  PATIENT
}
